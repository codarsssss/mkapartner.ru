{% extends 'homeapp/base.html' %}
{% load static %}

{% block content %}
<div class="container">
  <div class="page-section">
    <h1 class="title title_h2">Практика адвокатов нашей коллегии</h1>

    <!-- ФИЛЬТРЫ -->
    <div class="row mb-4">
      <div class="col-md-6">
        <label for="categoryFilter">По категории</label>
        <select id="categoryFilter" class="form-control">
          <option value="">Все категории</option>
          {% for category in practice_categories %}
          <option value="{{ category.id }}">{{ category.title }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-6">
        <label for="partnerFilter">По адвокату</label>
        <select id="partnerFilter" class="form-control">
          <option value="">Все адвокаты</option>
          {% for partner in partners %}
          <option value="{{ partner.id }}">{{ partner.name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <!-- СПИСОК ДЕЛ -->
    <div class="practices" id="casesContainer">
      {% include 'homeapp/partials/_practice_list.html' with items=practice_instances %}
    </div>
  </div>
</div>

<!-- AJAX-скрипт -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const categoryFilter = document.getElementById('categoryFilter');
    const partnerFilter = document.getElementById('partnerFilter');
    const container = document.getElementById('casesContainer');

    function fetchFilteredCases() {
      const category = categoryFilter.value;
      const partner = partnerFilter.value;

      const params = new URLSearchParams();
      if (category) params.append('category', category);
      if (partner) params.append('partner', partner);

      fetch(`/cases/filter/?${params}`, {
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
      })
      .then(response => response.json())
      .then(data => {
        container.innerHTML = data.html;
      });
    }

    categoryFilter.addEventListener('change', fetchFilteredCases);
    partnerFilter.addEventListener('change', fetchFilteredCases);
  });
</script>
{% endblock %}
